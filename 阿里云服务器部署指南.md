# é˜¿é‡Œäº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å— (Ubuntu ç³»ç»Ÿ)

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

æœ¬æŒ‡å—ä¸“é—¨é’ˆå¯¹ **Ubuntu 22.04 LTS** ç³»ç»Ÿç¼–å†™ï¼Œæä¾›å®Œæ•´çš„é¡¹ç›®éƒ¨ç½²æµç¨‹ã€‚

**ç³»ç»Ÿç¡®è®¤ï¼š**

```bash
# ç¡®è®¤ç³»ç»Ÿç‰ˆæœ¬
lsb_release -a

# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y
```

> ğŸ’¡ **æç¤º**: å¦‚æœæ‚¨çš„æœåŠ¡å™¨ä¸æ˜¯Ubuntuç³»ç»Ÿï¼Œå»ºè®®é‡æ–°åˆ›å»ºå®ä¾‹å¹¶é€‰æ‹©Ubuntu 22.04 LTSç³»ç»Ÿã€‚

***

## 1. æœåŠ¡å™¨é…ç½®è¦æ±‚

### æ¨èé…ç½®

* **å®ä¾‹è§„æ ¼**: ecs.c-c1m1.large (2 vCPU, 2 GiBå†…å­˜) æˆ–æ›´é«˜

* **æ“ä½œç³»ç»Ÿ**: **Ubuntu 22.04 LTS 64ä½**

* **å­˜å‚¨**: è‡³å°‘40GBç³»ç»Ÿç›˜

* **ç½‘ç»œ**: 3Mbpså¸¦å®½èµ·æ­¥

* **åœ°åŸŸ**: é€‰æ‹©ç¦»ç”¨æˆ·æœ€è¿‘çš„åœ°åŸŸï¼ˆå¦‚ååŒ—2-åŒ—äº¬ï¼‰

### Ubuntu 22.04 LTS ä¼˜åŠ¿

* âœ… é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œç¨³å®šå¯é 

* âœ… aptåŒ…ç®¡ç†å™¨ç®€å•æ˜“ç”¨

* âœ… ç¤¾åŒºæ”¯æŒä¸°å¯Œï¼Œæ–‡æ¡£å®Œå–„

* âœ… Dockerå’ŒNode.jsæ”¯æŒè‰¯å¥½

* âœ… å®‰å…¨æ›´æ–°åŠæ—¶ï¼Œç»´æŠ¤æˆæœ¬ä½

## 2. æœåŠ¡å™¨åˆå§‹åŒ–é…ç½®

### 2.1 è¿æ¥æœåŠ¡å™¨

```bash
# ä½¿ç”¨SSHè¿æ¥æœåŠ¡å™¨ï¼ˆæ›¿æ¢your_server_ipä¸ºå®é™…IPï¼‰
ssh root@your_server_ip
```

### 2.2 éªŒè¯ç³»ç»Ÿä¿¡æ¯

```bash
# æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬
lsb_release -a

# æŸ¥çœ‹ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯
cat /etc/os-release

# æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬
uname -r
```

### 2.3 ç³»ç»Ÿæ›´æ–°å’ŒåŸºç¡€å·¥å…·å®‰è£…

```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# å‡çº§ç³»ç»Ÿ
sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y curl wget git vim htop unzip build-essential

# å®‰è£…ç½‘ç»œå’Œç³»ç»Ÿå·¥å…·
sudo apt install -y net-tools ufw software-properties-common apt-transport-https ca-certificates gnupg lsb-release

# éªŒè¯å®‰è£…
which curl git vim
```

### 2.4 åˆ›å»ºérootç”¨æˆ·

```bash
# åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆä¼šæç¤ºè®¾ç½®å¯†ç å’Œç”¨æˆ·ä¿¡æ¯ï¼‰
sudo adduser deploy

# æ·»åŠ sudoæƒé™
sudo usermod -aG sudo deploy

# éªŒè¯ç”¨æˆ·åˆ›å»ºæˆåŠŸ
id deploy

# åˆ‡æ¢åˆ°æ–°ç”¨æˆ·
su - deploy

# éªŒè¯sudoæƒé™
sudo whoami
```

### 2.5 é…ç½®SSHå¯†é’¥ï¼ˆæ¨èï¼‰

```bash
# åœ¨æœ¬åœ°ç”ŸæˆSSHå¯†é’¥å¯¹
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

# å°†å…¬é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨
ssh-copy-id deploy@your_server_ip
```

## 3. å®‰å…¨é…ç½®

### 3.1 é…ç½®UFWé˜²ç«å¢™

```bash
# é‡ç½®é˜²ç«å¢™è§„åˆ™ï¼ˆå¯é€‰ï¼‰
sudo ufw --force reset

# è®¾ç½®é»˜è®¤ç­–ç•¥
sudo ufw default deny incoming
sudo ufw default allow outgoing

# å…è®¸SSHï¼ˆé‡è¦ï¼šå…ˆè®¾ç½®SSHè§„åˆ™å†å¯ç”¨é˜²ç«å¢™ï¼‰
sudo ufw allow ssh
sudo ufw allow 22/tcp

# å…è®¸HTTPå’ŒHTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# å…è®¸åº”ç”¨ç«¯å£
sudo ufw allow 3000/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status verbose

# æŸ¥çœ‹ç¼–å·è§„åˆ™ï¼ˆä¾¿äºåç»­ç®¡ç†ï¼‰
sudo ufw status numbered
```

### 3.2 é…ç½®SSHå®‰å…¨

```bash
# å¤‡ä»½åŸå§‹é…ç½®
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup

# ç¼–è¾‘SSHé…ç½®
sudo vim /etc/ssh/sshd_config

# æ¨èçš„å®‰å…¨é…ç½®ï¼š
# Port 22                          # å¯ä»¥æ”¹ä¸ºå…¶ä»–ç«¯å£
# PermitRootLogin no               # ç¦æ­¢rootç›´æ¥ç™»å½•
# PasswordAuthentication yes       # å¦‚æœä½¿ç”¨å¯†é’¥å¯è®¾ä¸ºno
# PubkeyAuthentication yes         # å¯ç”¨å¯†é’¥è®¤è¯
# MaxAuthTries 3                   # æœ€å¤§è®¤è¯å°è¯•æ¬¡æ•°
# ClientAliveInterval 300          # å®¢æˆ·ç«¯å­˜æ´»æ£€æµ‹é—´éš”
# ClientAliveCountMax 2            # æœ€å¤§å­˜æ´»æ£€æµ‹æ¬¡æ•°

# æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
sudo sshd -t

# é‡å¯SSHæœåŠ¡
sudo systemctl restart ssh

# éªŒè¯SSHæœåŠ¡çŠ¶æ€
sudo systemctl status ssh
```

### 3.3 é˜¿é‡Œäº‘å®‰å…¨ç»„é…ç½®

åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°é…ç½®å®‰å…¨ç»„è§„åˆ™ï¼š

* å…¥æ–¹å‘ï¼šå…è®¸22(SSH)ã€80(HTTP)ã€443(HTTPS)ã€3000(åº”ç”¨ç«¯å£)

* å‡ºæ–¹å‘ï¼šå…è®¸æ‰€æœ‰

## 4. ç¯å¢ƒå®‰è£…

### 4.1 å®‰è£…Node.js

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨NodeSourceå®˜æ–¹æºï¼ˆæ¨èï¼‰
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# æ–¹æ³•2ï¼šä½¿ç”¨snapå®‰è£…ï¼ˆå¤‡é€‰ï¼‰
# sudo snap install node --classic

# éªŒè¯å®‰è£…
node --version
npm --version

# é…ç½®npmå…¨å±€åŒ…è·¯å¾„ï¼ˆé¿å…æƒé™é—®é¢˜ï¼‰
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

# å®‰è£…å¸¸ç”¨å…¨å±€åŒ…
npm install -g pnpm pm2 yarn

# éªŒè¯å…¨å±€åŒ…å®‰è£…
pnpm --version
pm2 --version
```

### 4.2 å®‰è£…Docker

```bash
# å¸è½½æ—§ç‰ˆæœ¬Dockerï¼ˆå¦‚æœå­˜åœ¨ï¼‰
sudo apt-get remove docker docker-engine docker.io containerd runc

# å®‰è£…ä¾èµ–
sudo apt-get update
sudo apt-get install -y apt-transport-https ca-certificates curl gnupg lsb-release

# æ·»åŠ Dockerå®˜æ–¹GPGå¯†é’¥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

# æ·»åŠ Dockeræº
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# å®‰è£…Docker Engine
sudo apt-get update
sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin

# å¯åŠ¨DockeræœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°dockerç»„
sudo usermod -aG docker $USER

# é‡æ–°ç™»å½•æˆ–æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿ç»„æƒé™ç”Ÿæ•ˆ
newgrp docker

# éªŒè¯å®‰è£…
docker --version
docker compose version
sudo docker run hello-world
```

### 4.3 å®‰è£…Nginx

```bash
# å®‰è£…Nginx
sudo apt update
sudo apt install -y nginx

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl start nginx
sudo systemctl enable nginx

# æ£€æŸ¥NginxçŠ¶æ€
sudo systemctl status nginx

# æµ‹è¯•Nginxé…ç½®
sudo nginx -t

# æŸ¥çœ‹Nginxç‰ˆæœ¬
nginx -v

# è®¾ç½®é˜²ç«å¢™å…è®¸Nginx
sudo ufw allow 'Nginx Full'

# éªŒè¯Nginxæ˜¯å¦æ­£å¸¸è¿è¡Œ
curl -I http://localhost

# æŸ¥çœ‹Nginxè¿›ç¨‹
ps aux | grep nginx
```

## 5. é¡¹ç›®éƒ¨ç½²

### 5.1 ä¸Šä¼ é¡¹ç›®ä»£ç 

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨Gitå…‹éš†
cd /home/deploy
git clone https://github.com/your-username/your-project.git
cd your-project

# æ–¹æ³•2ï¼šä½¿ç”¨scpä¸Šä¼ ï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰
scp -r ./your-project deploy@your_server_ip:/home/deploy/
```

### 5.2 å®‰è£…é¡¹ç›®ä¾èµ–

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/deploy/your-project

# å®‰è£…ä¾èµ–
npm install
# æˆ–è€…ä½¿ç”¨pnpm
pnpm install
```

### 5.3 é…ç½®ç¯å¢ƒå˜é‡

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env
vim .env

# é…ç½®ä»¥ä¸‹å˜é‡ï¼š
# NODE_ENV=production
# PORT=3000
# SUPABASE_URL=your_supabase_url
# SUPABASE_ANON_KEY=your_supabase_anon_key
# SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key
```

### 5.4 æ„å»ºé¡¹ç›®

```bash
# æ„å»ºå‰ç«¯
npm run build

# å¦‚æœæœ‰åç«¯APIï¼Œç¡®ä¿APIæœåŠ¡æ­£å¸¸
npm run start:api
```

## 6. æ•°æ®åº“é…ç½®

### 6.1 ä½¿ç”¨Supabaseï¼ˆæ¨èï¼‰

**ä¸ºä»€ä¹ˆé€‰æ‹©Supabaseï¼š**

* âœ… å…è´¹é¢åº¦å……è¶³ï¼Œé€‚åˆä¸­å°å‹é¡¹ç›®

* âœ… è‡ªå¸¦è®¤è¯ç³»ç»Ÿï¼Œæ— éœ€é¢å¤–å¼€å‘

* âœ… å®æ—¶æ•°æ®åº“åŠŸèƒ½

* âœ… è‡ªåŠ¨å¤‡ä»½å’Œæ‰©å±•

* âœ… æ— éœ€æœåŠ¡å™¨ç»´æŠ¤

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º.envæ–‡ä»¶
cd /home/deploy/your-project
vim .env

# æ·»åŠ Supabaseé…ç½®
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
NODE_ENV=production
PORT=3000
```

### 6.2 æœ¬åœ°PostgreSQLï¼ˆå¯é€‰ï¼‰

> ğŸ’¡ **æ³¨æ„**: åªæœ‰åœ¨ç‰¹æ®Šéœ€æ±‚ä¸‹æ‰å»ºè®®ä½¿ç”¨æœ¬åœ°æ•°æ®åº“ï¼ŒSupabaseå·²èƒ½æ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚ã€‚

```bash
# å®‰è£…PostgreSQL
sudo apt update
sudo apt install -y postgresql postgresql-contrib

# å¯åŠ¨å¹¶å¯ç”¨æœåŠ¡
sudo systemctl start postgresql
sudo systemctl enable postgresql

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status postgresql

# è®¾ç½®postgresç”¨æˆ·å¯†ç 
sudo passwd postgres

# åˆ›å»ºåº”ç”¨æ•°æ®åº“å’Œç”¨æˆ·
sudo -u postgres psql

-- åœ¨PostgreSQLå‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š
CREATE DATABASE your_app_db;
CREATE USER your_app_user WITH PASSWORD 'your_strong_password';
GRANT ALL PRIVILEGES ON DATABASE your_app_db TO your_app_user;
ALTER USER your_app_user CREATEDB;
\q

# é…ç½®PostgreSQLå…è®¸æœ¬åœ°è¿æ¥
sudo vim /etc/postgresql/14/main/pg_hba.conf
# æ‰¾åˆ°å¹¶ä¿®æ”¹ï¼š
# local   all             all                                     md5

# é‡å¯PostgreSQL
sudo systemctl restart postgresql

# æµ‹è¯•è¿æ¥
psql -h localhost -U your_app_user -d your_app_db
```

## 7. Nginxåå‘ä»£ç†é…ç½®

### 7.1 åˆ›å»ºNginxé…ç½®æ–‡ä»¶

```bash
sudo vim /etc/nginx/sites-available/your-app
```

### 7.2 é…ç½®å†…å®¹

```nginx
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;

    # é™æ€æ–‡ä»¶
    location / {
        root /home/deploy/your-project/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # æ—¥å¿—
    access_log /var/log/nginx/your-app.access.log;
    error_log /var/log/nginx/your-app.error.log;
}
```

### 7.3 å¯ç”¨é…ç½®

```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/your-app /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

## 8. SSLè¯ä¹¦é…ç½®

### 8.1 å®‰è£…Certbot

```bash
# å®‰è£…Certbot
sudo apt install -y certbot python3-certbot-nginx
```

### 8.2 è·å–SSLè¯ä¹¦

```bash
# è·å–è¯ä¹¦ï¼ˆæ›¿æ¢your-domain.comï¼‰
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œï¼š
0 12 * * * /usr/bin/certbot renew --quiet
```

## 9. è¿›ç¨‹ç®¡ç†

### 9.1 ä½¿ç”¨PM2ç®¡ç†Node.jsåº”ç”¨

```bash
# å®‰è£…PM2
npm install -g pm2

# åˆ›å»ºPM2é…ç½®æ–‡ä»¶
vim ecosystem.config.js
```

### 9.2 PM2é…ç½®æ–‡ä»¶

```javascript
module.exports = {
  apps: [{
    name: 'your-app-api',
    script: './api/server.js',
    instances: 'max',
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true
  }]
};
```

### 9.3 å¯åŠ¨åº”ç”¨

```bash
# å¯åŠ¨åº”ç”¨
pm2 start ecosystem.config.js

# ä¿å­˜PM2é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u deploy --hp /home/deploy
```

## 10. åŸŸåé…ç½®

### 10.1 åŸŸåè§£æ

åœ¨åŸŸåæœåŠ¡å•†å¤„æ·»åŠ Aè®°å½•ï¼š

* ä¸»æœºè®°å½•ï¼š@ æˆ– www

* è®°å½•ç±»å‹ï¼šA

* è®°å½•å€¼ï¼šæœåŠ¡å™¨å…¬ç½‘IP

* TTLï¼š600

### 10.2 éªŒè¯åŸŸåè§£æ

```bash
# æ£€æŸ¥åŸŸåè§£æ
nslookup your-domain.com
ping your-domain.com
```

## 11. ç›‘æ§å’Œæ—¥å¿—

### 11.1 ç³»ç»Ÿç›‘æ§

```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
netstat -tulpn
```

### 11.2 åº”ç”¨æ—¥å¿—

```bash
# PM2æ—¥å¿—
pm2 logs

# Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# ç³»ç»Ÿæ—¥å¿—
sudo journalctl -u nginx -f
```

## 12. è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

### 12.1 åˆ›å»ºéƒ¨ç½²è„šæœ¬

```bash
vim deploy.sh
```

### 12.2 éƒ¨ç½²è„šæœ¬å†…å®¹

```bash
#!/bin/bash

# éƒ¨ç½²è„šæœ¬
set -e

echo "å¼€å§‹éƒ¨ç½²..."

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
npm run build

# é‡å¯APIæœåŠ¡
pm2 restart your-app-api

# é‡å¯Nginx
sudo systemctl reload nginx

echo "éƒ¨ç½²å®Œæˆï¼"
```

### 12.3 è®¾ç½®æ‰§è¡Œæƒé™

```bash
chmod +x deploy.sh
```

## 13. å¤‡ä»½ç­–ç•¥

### 13.1 æ•°æ®åº“å¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
vim backup.sh

#!/bin/bash
DATE=$(date +"%Y%m%d_%H%M%S")
BACKUP_DIR="/home/deploy/backups"
mkdir -p $BACKUP_DIR

# å¤‡ä»½é¡¹ç›®æ–‡ä»¶
tar -czf $BACKUP_DIR/project_$DATE.tar.gz /home/deploy/your-project

# å¦‚æœä½¿ç”¨æœ¬åœ°PostgreSQL
# pg_dump -U your_app_user -h localhost your_app_db > $BACKUP_DIR/db_$DATE.sql

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete

echo "å¤‡ä»½å®Œæˆï¼š$DATE"
```

### 13.2 è®¾ç½®å®šæ—¶å¤‡ä»½

```bash
# è®¾ç½®å®šæ—¶ä»»åŠ¡
crontab -e

# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /home/deploy/backup.sh
```

## 14. å¸¸è§é—®é¢˜è§£å†³

### 14.1 ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tulpn | grep :3000

# æ€æ­»è¿›ç¨‹
sudo kill -9 PID
```

### 14.2 æƒé™é—®é¢˜

```bash
# ä¿®æ”¹æ–‡ä»¶æƒé™
sudo chown -R deploy:deploy /home/deploy/your-project
sudo chmod -R 755 /home/deploy/your-project
```

### 14.3 å†…å­˜ä¸è¶³

```bash
# åˆ›å»ºäº¤æ¢æ–‡ä»¶
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# æ°¸ä¹…å¯ç”¨
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

### 14.4 Nginxé…ç½®é”™è¯¯

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

## 15. æ€§èƒ½ä¼˜åŒ–

### 15.1 Nginxä¼˜åŒ–

```nginx
# åœ¨/etc/nginx/nginx.confä¸­æ·»åŠ 
worker_processes auto;
worker_connections 1024;

# å¯ç”¨gzipå‹ç¼©
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
```

### 15.2 Node.jsä¼˜åŒ–

```bash
# è®¾ç½®Node.jså†…å­˜é™åˆ¶
export NODE_OPTIONS="--max-old-space-size=1024"
```

## 16. å®‰å…¨åŠ å›º

### 16.1 é…ç½®è‡ªåŠ¨å®‰å…¨æ›´æ–°
```bash
# å®‰è£…è‡ªåŠ¨æ›´æ–°å·¥å…·
sudo apt install -y unattended-upgrades apt-listchanges

# é…ç½®è‡ªåŠ¨æ›´æ–°
sudo dpkg-reconfigure -plow unattended-upgrades

# ç¼–è¾‘è‡ªåŠ¨æ›´æ–°é…ç½®
sudo vim /etc/apt/apt.conf.d/50unattended-upgrades

# ç¡®ä¿ä»¥ä¸‹é…ç½®å¯ç”¨ï¼š
# Unattended-Upgrade::Automatic-Reboot "false";
# Unattended-Upgrade::Automatic-Reboot-Time "02:00";
# Unattended-Upgrade::Remove-Unused-Dependencies "true";

# å¯ç”¨è‡ªåŠ¨æ›´æ–°æœåŠ¡
sudo systemctl enable unattended-upgrades
sudo systemctl start unattended-upgrades

# æ£€æŸ¥è‡ªåŠ¨æ›´æ–°çŠ¶æ€
sudo systemctl status unattended-upgrades

# æŸ¥çœ‹æ›´æ–°æ—¥å¿—
sudo tail -f /var/log/unattended-upgrades/unattended-upgrades.log
```

### 16.2 å®‰è£…å’Œé…ç½®fail2ban
```bash
# å®‰è£…fail2ban
sudo apt update
sudo apt install -y fail2ban

# å¯åŠ¨å¹¶å¯ç”¨æœåŠ¡
sudo systemctl start fail2ban
sudo systemctl enable fail2ban

# åˆ›å»ºæœ¬åœ°é…ç½®æ–‡ä»¶
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local

# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo vim /etc/fail2ban/jail.local

# æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 3
ignoreip = 127.0.0.1/8 ::1

[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 3600

[nginx-http-auth]
enabled = true
filter = nginx-http-auth
logpath = /var/log/nginx/error.log

# é‡å¯fail2banæœåŠ¡
sudo systemctl restart fail2ban

# æ£€æŸ¥fail2bançŠ¶æ€
sudo fail2ban-client status
sudo fail2ban-client status sshd

# æŸ¥çœ‹è¢«å°ç¦çš„IP
sudo fail2ban-client get sshd banned
```

## æ€»ç»“

æœ¬æŒ‡å—ä¸“é—¨é’ˆå¯¹Ubuntu 22.04 LTSç³»ç»Ÿï¼Œæä¾›äº†å®Œæ•´çš„é¡¹ç›®éƒ¨ç½²æµç¨‹ã€‚æŒ‰ç…§è¿™äº›æ­¥éª¤ï¼Œæ‚¨å¯ä»¥æˆåŠŸå°†é¡¹ç›®éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šã€‚

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æ£€æŸ¥æ¸…å•

### ç³»ç»Ÿå‡†å¤‡
- [ ] ç¡®è®¤Ubuntu 22.04 LTSç³»ç»Ÿ
- [ ] æ›´æ–°ç³»ç»Ÿï¼š`sudo apt update && sudo apt upgrade -y`
- [ ] åˆ›å»ºdeployç”¨æˆ·å¹¶é…ç½®sudoæƒé™
- [ ] é…ç½®SSHå¯†é’¥ç™»å½•

### å®‰å…¨é…ç½®
- [ ] é…ç½®UFWé˜²ç«å¢™
- [ ] ä¼˜åŒ–SSHå®‰å…¨è®¾ç½®
- [ ] å®‰è£…é…ç½®fail2ban
- [ ] å¯ç”¨è‡ªåŠ¨å®‰å…¨æ›´æ–°

### ç¯å¢ƒå®‰è£…
- [ ] å®‰è£…Node.js 18.x LTS
- [ ] å®‰è£…Dockerå’ŒDocker Compose
- [ ] å®‰è£…Nginx
- [ ] å®‰è£…PM2è¿›ç¨‹ç®¡ç†å™¨

### é¡¹ç›®éƒ¨ç½²
- [ ] ä¸Šä¼ é¡¹ç›®ä»£ç 
- [ ] é…ç½®ç¯å¢ƒå˜é‡(.env)
- [ ] å®‰è£…é¡¹ç›®ä¾èµ–
- [ ] æ„å»ºé¡¹ç›®
- [ ] é…ç½®Nginxåå‘ä»£ç†
- [ ] å¯åŠ¨åº”ç”¨æœåŠ¡

### åŸŸåå’ŒSSL
- [ ] é…ç½®åŸŸåè§£æ
- [ ] å®‰è£…SSLè¯ä¹¦
- [ ] éªŒè¯HTTPSè®¿é—®

### ç›‘æ§å’Œç»´æŠ¤
- [ ] é…ç½®æ—¥å¿—ç›‘æ§
- [ ] è®¾ç½®è‡ªåŠ¨å¤‡ä»½
- [ ] æµ‹è¯•æ‰€æœ‰åŠŸèƒ½

## ğŸ”§ å¸¸ç”¨è¿ç»´å‘½ä»¤

```bash
# ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
sudo systemctl status nginx
sudo systemctl status docker
pm2 status

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
pm2 logs
sudo journalctl -u nginx -f

# é˜²ç«å¢™ç®¡ç†
sudo ufw status
sudo fail2ban-client status

# ç³»ç»Ÿèµ„æºç›‘æ§
htop
df -h
free -h
```

## âš ï¸ é‡è¦æé†’

1. **å®šæœŸå¤‡ä»½æ•°æ®** - è®¾ç½®è‡ªåŠ¨å¤‡ä»½è„šæœ¬
2. **ç›‘æ§æœåŠ¡å™¨æ€§èƒ½** - ä½¿ç”¨htopã€dfç­‰å·¥å…·
3. **åŠæ—¶æ›´æ–°ç³»ç»Ÿ** - å·²é…ç½®è‡ªåŠ¨å®‰å…¨æ›´æ–°
4. **æ£€æŸ¥å®‰å…¨æ—¥å¿—** - å®šæœŸæŸ¥çœ‹fail2banå’Œç³»ç»Ÿæ—¥å¿—
5. **æµ‹è¯•å¤‡ä»½æ¢å¤** - ç¡®ä¿å¤‡ä»½å¯ç”¨

## ğŸ†˜ æ•…éšœæ’é™¤

å¦‚é‡é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºæ’æŸ¥ï¼š
1. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š`sudo systemctl status service_name`
2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`sudo journalctl -u service_name -f`
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼š`sudo ufw status`
4. éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•ï¼š`sudo nginx -t`
5. é‡å¯ç›¸å…³æœåŠ¡ï¼š`sudo systemctl restart service_name`

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„åº”ç”¨å°†é€šè¿‡åŸŸåå®‰å…¨è®¿é—®ï¼Œæ‰€æœ‰æœåŠ¡éƒ½å·²ä¼˜åŒ–é…ç½®ï¼Œå¯ä»¥ç¨³å®šè¿è¡Œã€‚